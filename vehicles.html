<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Vehicles - Prodigy Auto Care</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cream': '#EFE4D2',
                        'blue-dark': '#254D70',
                        'navy': '#131D4F',
                        'brown': '#954C2E'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                        'display': ['Poppins', 'system-ui', '-apple-system', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #EFE4D2;
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
        }
        
        .bg-gradient-primary {
            background: linear-gradient(135deg, #254D70 0%, #131D4F 100%);
        }
        
        /* Mobile-specific optimizations */
        @media (max-width: 640px) {
            .vehicle-card {
                padding: 1rem;
            }
            
            .mobile-stack {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header/Navigation -->
    <header class="bg-gradient-primary text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16 sm:h-20">
                <!-- Logo -->
                <a href="landing.html" class="flex items-center space-x-2 sm:space-x-3">
                    <div class="relative">
                        <i class="fas fa-car text-cream text-2xl sm:text-3xl" style="text-shadow: 0 0 10px rgba(239, 228, 210, 0.5);"></i>
                        <div class="absolute -top-1 -right-1 w-2 h-2 sm:w-3 sm:h-3 bg-brown rounded-full opacity-75 animate-pulse"></div>
                    </div>
                    <div>
                        <h1 class="text-cream text-xl sm:text-3xl font-bold font-display tracking-wide" style="text-shadow: 0 0 10px rgba(239, 228, 210, 0.5);">Prodigy</h1>
                        <p class="text-cream/70 text-xs font-medium tracking-widest uppercase">AUTO CARE</p>
                    </div>
                </a>
                
                <!-- Desktop Navigation -->
                <div class="hidden lg:flex items-center space-x-8">
                    <a href="customer-home.html" class="text-cream hover:text-cream/80 transition-all duration-300 font-medium">Home</a>
                    <a href="bookings.html" class="text-cream hover:text-cream/80 transition-all duration-300 font-medium">My Bookings</a>
                    <a href="vehicles.html" class="text-cream font-semibold border-b-2 border-cream pb-1">My Vehicles</a>
                    <a href="profile.html" class="text-cream hover:text-cream/80 transition-all duration-300 font-medium">Profile</a>
                </div>
                
                <!-- Mobile/Desktop Actions -->
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <!-- Mobile Sign Out Button -->
                    <button id="logout-btn" class="bg-brown text-white px-3 py-2 sm:px-4 sm:py-2 rounded-lg hover:bg-brown/90 transition-all duration-300 flex items-center space-x-1 sm:space-x-2">
                        <i class="fas fa-sign-out-alt text-sm sm:text-base"></i>
                        <span class="text-sm sm:text-base">Sign Out</span>
                    </button>
                    
                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-button" class="lg:hidden text-white p-2">
                        <i class="fas fa-bars text-lg sm:text-xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="lg:hidden hidden py-4 border-t border-white/20">
                <div class="flex flex-col space-y-4">
                    <a href="customer-home.html" class="text-cream hover:text-cream/80 transition-all duration-300 font-medium">Home</a>
                    <a href="bookings.html" class="text-cream hover:text-cream/80 transition-all duration-300 font-medium">My Bookings</a>
                    <a href="vehicles.html" class="text-cream font-semibold">My Vehicles</a>
                    <a href="profile.html" class="text-cream hover:text-cream/80 transition-all duration-300 font-medium">Profile</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6 sm:py-8">
        <!-- Header -->
        <div class="mb-6 sm:mb-8">
            <h1 class="text-2xl sm:text-3xl font-bold text-navy mb-2">My Vehicles</h1>
            <p class="text-gray-600 text-sm sm:text-base">Manage your registered vehicles</p>
        </div>
        
        <!-- Add Vehicle Button - Mobile Optimized -->
        <div class="mb-6 sm:mb-8">
            <button id="add-vehicle-btn" class="w-full sm:w-auto bg-blue-dark text-white px-4 py-3 sm:py-2 rounded-lg hover:bg-navy transition-all duration-300 flex items-center justify-center space-x-2">
                <i class="fas fa-plus"></i>
                <span>Add New Vehicle</span>
            </button>
        </div>
        
        <!-- Vehicles Grid -->
        <div id="vehicles-container" class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
            <!-- Will be populated by JavaScript -->
        </div>
        
        <!-- Empty State -->
        <div id="no-vehicles" class="hidden bg-white rounded-lg shadow-md p-6 sm:p-10 text-center">
            <i class="fas fa-car text-gray-400 text-3xl sm:text-4xl mb-4"></i>
            <h3 class="text-lg sm:text-xl font-bold text-navy mb-2">No Vehicles Yet</h3>
            <p class="text-gray-600 text-sm sm:text-base mb-6">Add your first vehicle to get started with bookings</p>
            <button class="bg-blue-dark text-white px-6 py-3 rounded-lg hover:bg-navy transition-all" onclick="document.getElementById('add-vehicle-btn').click()">
                <i class="fas fa-plus mr-2"></i>Add Your First Vehicle
            </button>
        </div>
    </main>

    <!-- Add Vehicle Modal -->
    <div id="vehicle-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md">
            <div class="flex justify-between items-center p-4 sm:p-6 border-b">
                <h3 class="text-lg sm:text-xl font-bold text-navy">Add New Vehicle</h3>
                <button id="close-vehicle-modal" class="text-gray-500 hover:text-gray-700 p-1">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            
            <form id="add-vehicle-form" class="p-4 sm:p-6 space-y-4">
                <div>
                    <label for="vehicle-make" class="block text-sm font-medium text-gray-700 mb-1">Make</label>
                    <input type="text" id="vehicle-make" class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-dark focus:border-blue-dark" required>
                </div>
                <div>
                    <label for="vehicle-model" class="block text-sm font-medium text-gray-700 mb-1">Model</label>
                    <input type="text" id="vehicle-model" class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-dark focus:border-blue-dark" required>
                </div>
                <div>
                    <label for="vehicle-plate" class="block text-sm font-medium text-gray-700 mb-1">Plate Number</label>
                    <input type="text" id="vehicle-plate" class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-dark focus:border-blue-dark" required>
                </div>
                <div>
                    <label for="vehicle-type" class="block text-sm font-medium text-gray-700 mb-1">Vehicle Type</label>
                    <select id="vehicle-type" class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-dark focus:border-blue-dark" required>
                        <option value="">Select type</option>
                        <option value="Sedan">Sedan</option>
                        <option value="SUV">SUV</option>
                        <option value="Hatchback">Hatchback</option>
                        <option value="Pickup">Pickup Truck</option>
                        <option value="Van">Van</option>
                        <option value="Motorcycle">Motorcycle</option>
                    </select>
                </div>
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 pt-4">
                    <button type="button" id="cancel-vehicle" class="w-full bg-gray-300 text-gray-700 py-3 rounded-lg font-semibold hover:bg-gray-400 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="w-full bg-blue-dark text-white py-3 rounded-lg font-semibold hover:bg-navy transition-colors">
                        Add Vehicle
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="firebase.js"></script>
    <script type="module">
        import { 
            auth, 
            onAuthChange, 
            getCurrentUser,
            getUserVehicles,
            addVehicle,
            updateVehicle,
            deleteVehicle
        } from './firebase.js';

        let currentUser = null;
        let userVehicles = [];

        document.addEventListener('DOMContentLoaded', function() {
            initializeVehiclesPage();
        });

        function initializeVehiclesPage() {
            onAuthChange(async (user) => {
                if (user) {
                    currentUser = await getCurrentUser();
                    if (currentUser) {
                        await loadVehicles();
                    }
                } else {
                    window.location.href = 'login.html';
                }
            });

            initializeEventListeners();
        }

        function initializeEventListeners() {
            // Mobile menu toggle
            document.getElementById('mobile-menu-button').addEventListener('click', () => {
                const mobileMenu = document.getElementById('mobile-menu');
                mobileMenu.classList.toggle('hidden');
            });

            // Vehicle modal
            document.getElementById('add-vehicle-btn').addEventListener('click', () => {
                document.getElementById('vehicle-modal').classList.remove('hidden');
            });

            document.getElementById('close-vehicle-modal').addEventListener('click', () => {
                document.getElementById('vehicle-modal').classList.add('hidden');
            });

            document.getElementById('cancel-vehicle').addEventListener('click', () => {
                document.getElementById('vehicle-modal').classList.add('hidden');
            });

            document.getElementById('add-vehicle-form').addEventListener('submit', handleAddVehicle);

            // Logout
            document.getElementById('logout-btn').addEventListener('click', () => {
                window.location.href = 'landing.html';
            });
        }

        async function loadVehicles() {
            try {
                userVehicles = await getUserVehicles();
                displayVehicles();
            } catch (error) {
                console.error('Error loading vehicles:', error);
            }
        }

        function displayVehicles() {
            const container = document.getElementById('vehicles-container');
            const noVehicles = document.getElementById('no-vehicles');

            if (userVehicles.length === 0) {
                container.classList.add('hidden');
                noVehicles.classList.remove('hidden');
                return;
            }

            container.classList.remove('hidden');
            noVehicles.classList.add('hidden');
            container.innerHTML = '';

            userVehicles.forEach(vehicle => {
                const vehicleCard = createVehicleCard(vehicle);
                container.appendChild(vehicleCard);
            });
        }

        function createVehicleCard(vehicle) {
            const div = document.createElement('div');
            div.className = 'vehicle-card bg-white rounded-lg shadow-md p-4 sm:p-6 hover:shadow-lg transition-shadow';

            div.innerHTML = `
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mobile-stack">
                    <div class="flex items-center space-x-3 sm:space-x-4 mb-3 sm:mb-0">
                        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-navy text-white rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="fas fa-car text-sm sm:text-base"></i>
                        </div>
                        <div class="min-w-0 flex-1">
                            <h3 class="text-base sm:text-lg font-bold text-navy truncate">${vehicle.make} ${vehicle.model}</h3>
                            <p class="text-sm sm:text-base text-gray-600">${vehicle.plateNumber}</p>
                            <p class="text-xs sm:text-sm text-gray-500">${vehicle.vehicle_type || 'Unknown Type'}</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center space-x-2 self-end sm:self-auto">
                        <button class="edit-vehicle-btn text-blue-dark hover:text-navy p-2 rounded-lg hover:bg-gray-100 transition-colors" data-vehicle-id="${vehicle.id}" title="Edit Vehicle">
                            <i class="fas fa-edit text-sm sm:text-base"></i>
                        </button>
                        <button class="delete-vehicle-btn text-red-600 hover:text-red-800 p-2 rounded-lg hover:bg-gray-100 transition-colors" data-vehicle-id="${vehicle.id}" title="Delete Vehicle">
                            <i class="fas fa-trash text-sm sm:text-base"></i>
                        </button>
                    </div>
                </div>
            `;

            // Add event listeners
            const editBtn = div.querySelector('.edit-vehicle-btn');
            const deleteBtn = div.querySelector('.delete-vehicle-btn');

            editBtn.addEventListener('click', () => editVehicle(vehicle));
            deleteBtn.addEventListener('click', () => deleteVehicleConfirm(vehicle.id));

            return div;
        }

        async function handleAddVehicle(e) {
            e.preventDefault();

            const make = document.getElementById('vehicle-make').value;
            const model = document.getElementById('vehicle-model').value;
            const plateNumber = document.getElementById('vehicle-plate').value;
            const vehicleType = document.getElementById('vehicle-type').value;

            try {
                await addVehicle(make, model, plateNumber, vehicleType);
                await loadVehicles();
                document.getElementById('vehicle-modal').classList.add('hidden');
                document.getElementById('add-vehicle-form').reset();
                alert('Vehicle added successfully!');
            } catch (error) {
                console.error('Error adding vehicle:', error);
                alert('Error adding vehicle: ' + error.message);
            }
        }

        function editVehicle(vehicle) {
            // Implementation for edit would go here
            alert('Edit vehicle functionality will be implemented');
        }

        async function deleteVehicleConfirm(vehicleId) {
            if (confirm('Are you sure you want to delete this vehicle?')) {
                try {
                    await deleteVehicle(vehicleId);
                    await loadVehicles();
                    alert('Vehicle deleted successfully!');
                } catch (error) {
                    console.error('Error deleting vehicle:', error);
                    alert('Error deleting vehicle: ' + error.message);
                }
            }
        }
    </script>
</body>
</html>
