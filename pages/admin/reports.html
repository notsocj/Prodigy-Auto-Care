<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cream': '#EFE4D2',
                        'blue-dark': '#254D70',
                        'navy': '#131D4F',
                        'brown': '#954C2E'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                        'display': ['Poppins', 'system-ui', '-apple-system', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../../public/assets/styles/global.css" rel="stylesheet">
    <style>
        /* Page Transition Animation */
        body {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-cream min-h-screen font-sans">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-navy via-blue-dark to-navy shadow-2xl border-b border-blue-dark/20">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-5">
                <div class="flex items-center space-x-3">
                    <div class="relative">
                        <i class="fas fa-car text-cream text-3xl"
                            style="text-shadow: 0 0 10px rgba(239, 228, 210, 0.5);"></i>
                        <div class="absolute -top-1 -right-1 w-3 h-3 bg-brown rounded-full opacity-75 animate-pulse">
                        </div>
                    </div>
                    <div>
                        <h1 class="text-cream text-3xl font-bold font-display tracking-wide"
                            style="text-shadow: 0 0 10px rgba(239, 228, 210, 0.5);">Prodigy</h1>
                        <p class="text-cream/70 text-xs font-medium tracking-widest uppercase">Admin Panel</p>
                    </div>
                </div>
                <div class="flex items-center space-x-6">
                    <a href="dashboard.html"
                        class="text-cream hover:text-cream/90 transition-all duration-300 font-medium">Dashboard</a>
                    <a href="bookings.html"
                        class="text-cream hover:text-cream/90 transition-all duration-300 font-medium">Bookings</a>
                    <a href="staff.html"
                        class="text-cream hover:text-cream/90 transition-all duration-300 font-medium">Staff</a>
                    <a href="reports.html" class="text-cream font-semibold border-b-2 border-cream pb-1">Reports</a>
                    <a href="settings.html"
                        class="text-cream hover:text-cream/90 transition-all duration-300 font-medium">Settings</a>
                </div>

                <button id="logout-btn"
                    class="bg-gradient-to-r from-brown to-brown/80 text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all duration-300 font-medium">
                    <i class="fas fa-user-shield mr-2"></i>Admin
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 py-6">
        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold font-display text-navy mb-2">Business Reports</h1>
            <p class="text-gray-600">Analyze your car wash business performance</p>
        </div>

        <!-- Time Period Selector -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
                <div class="flex items-center space-x-4">
                    <label class="font-medium text-gray-700">Time Period:</label>
                    <select id="time-period"
                        class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-dark focus:border-blue-dark">
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month" selected>This Month</option>
                        <option value="quarter">This Quarter</option>
                        <option value="year">This Year</option>
                        <option value="custom">Custom Range</option>
                    </select>
                </div>

                <div id="custom-range" class="hidden flex items-center space-x-2">
                    <input type="date" id="start-date" class="px-3 py-2 border border-gray-300 rounded-lg">
                    <span class="text-gray-500">to</span>
                    <input type="date" id="end-date" class="px-3 py-2 border border-gray-300 rounded-lg">
                </div>

                <button id="generate-report"
                    class="bg-blue-dark text-white px-6 py-2 rounded-lg hover:bg-navy transition-colors">
                    <i class="fas fa-chart-bar mr-2"></i>Generate Report
                </button>
            </div>
        </div>

        <!-- Key Metrics -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="w-12 h-12 bg-green-100 rounded-lg mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-peso-sign text-green-600 text-xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-navy" id="total-revenue">₱0</h3>
                <p class="text-sm text-gray-600">Total Revenue</p>
                <div class="mt-2">
                    <span id="revenue-change" class="text-sm text-green-600"><i class="fas fa-arrow-up"></i> 0%</span>
                    <span class="text-xs text-gray-500">vs previous period</span>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="w-12 h-12 bg-blue-100 rounded-lg mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-calendar-check text-blue-600 text-xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-navy" id="total-bookings">0</h3>
                <p class="text-sm text-gray-600">Total Bookings</p>
                <div class="mt-2">
                    <span id="bookings-change" class="text-sm text-green-600"><i class="fas fa-arrow-up"></i> 0%</span>
                    <span class="text-xs text-gray-500">vs previous period</span>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="w-12 h-12 bg-yellow-100 rounded-lg mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-calculator text-yellow-600 text-xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-navy" id="avg-order-value">₱0</h3>
                <p class="text-sm text-gray-600">Avg Order Value</p>
                <div class="mt-2">
                    <span id="aov-change" class="text-sm text-green-600"><i class="fas fa-arrow-up"></i> 0%</span>
                    <span class="text-xs text-gray-500">vs previous period</span>
                </div>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-6 text-center">
                <div class="w-12 h-12 bg-purple-100 rounded-lg mx-auto mb-4 flex items-center justify-center">
                    <i class="fas fa-star text-purple-600 text-xl"></i>
                </div>
                <h3 class="text-2xl font-bold text-navy" id="avg-rating">0.0</h3>
                <p class="text-sm text-gray-600">Customer Rating</p>
                <div class="mt-2">
                    <span id="rating-change" class="text-sm text-green-600"><i class="fas fa-arrow-up"></i> 0%</span>
                    <span class="text-xs text-gray-500">vs previous period</span>
                </div>
            </div>
        </div>

        <!-- Charts Row -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Revenue Chart -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold font-display text-navy">Revenue Trend</h2>
                    <select id="revenue-chart-type" class="px-3 py-1 border border-gray-300 rounded text-sm">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div class="h-64 flex items-center justify-center bg-gray-50 rounded-lg">
                    <div class="text-center text-gray-400">
                        <i class="fas fa-chart-line text-4xl mb-2"></i>
                        <p>Revenue chart will be implemented</p>
                        <p class="text-sm">Integration with Chart.js or similar library</p>
                    </div>
                </div>
            </div>

            <!-- Service Distribution -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold font-display text-navy mb-4">Service Distribution</h2>
                <div class="h-64 space-y-4">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-blue-500 rounded"></div>
                            <span class="text-gray-700">Premium Wash</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-gray-600">45%</span>
                            <span class="text-sm text-gray-500">(23 bookings)</span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-blue-500 h-2 rounded-full" style="width: 45%"></div>
                    </div>

                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-green-500 rounded"></div>
                            <span class="text-gray-700">Basic Wash</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-gray-600">35%</span>
                            <span class="text-sm text-gray-500">(18 bookings)</span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-green-500 h-2 rounded-full" style="width: 35%"></div>
                    </div>

                    <div class="flex items-center justify-between">
                        <div class="flex items-center space-x-3">
                            <div class="w-4 h-4 bg-yellow-500 rounded"></div>
                            <span class="text-gray-700">Deluxe Wash</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <span class="text-gray-600">20%</span>
                            <span class="text-sm text-gray-500">(10 bookings)</span>
                        </div>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                        <div class="bg-yellow-500 h-2 rounded-full" style="width: 20%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detailed Reports -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Top Customers -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold font-display text-navy mb-4">Top Customers</h2>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div
                                class="w-8 h-8 bg-blue-dark text-white rounded-full flex items-center justify-center text-sm font-bold">
                                1</div>
                            <div>
                                <p class="font-medium text-navy">Cj Sacdalan</p>
                                <p class="text-sm text-gray-600">8 bookings</p>
                            </div>
                        </div>
                        <span class="font-bold text-brown">₱2,800</span>
                    </div>

                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div
                                class="w-8 h-8 bg-gray-600 text-white rounded-full flex items-center justify-center text-sm font-bold">
                                2</div>
                            <div>
                                <p class="font-medium text-navy">Maria Santos</p>
                                <p class="text-sm text-gray-600">6 bookings</p>
                            </div>
                        </div>
                        <span class="font-bold text-brown">₱2,100</span>
                    </div>

                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div
                                class="w-8 h-8 bg-yellow-600 text-white rounded-full flex items-center justify-center text-sm font-bold">
                                3</div>
                            <div>
                                <p class="font-medium text-navy">John Doe</p>
                                <p class="text-sm text-gray-600">5 bookings</p>
                            </div>
                        </div>
                        <span class="font-bold text-brown">₱1,750</span>
                    </div>
                </div>
            </div>

            <!-- Staff Performance -->
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-bold font-display text-navy mb-4">Staff Performance</h2>
                <div class="space-y-4">
                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-green-500 text-white rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-sm"></i>
                            </div>
                            <div>
                                <p class="font-medium text-navy">Juan Dela Cruz</p>
                                <div class="flex items-center space-x-2">
                                    <div class="flex space-x-1">
                                        <i class="fas fa-star text-yellow-400 text-xs"></i>
                                        <i class="fas fa-star text-yellow-400 text-xs"></i>
                                        <i class="fas fa-star text-yellow-400 text-xs"></i>
                                        <i class="fas fa-star text-yellow-400 text-xs"></i>
                                        <i class="fas fa-star text-yellow-400 text-xs"></i>
                                    </div>
                                    <span class="text-sm text-gray-600">4.9 avg</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="font-bold text-navy">15 jobs</span>
                            <p class="text-sm text-gray-600">completed</p>
                        </div>
                    </div>

                    <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-8 h-8 bg-blue-500 text-white rounded-full flex items-center justify-center">
                                <i class="fas fa-user text-sm"></i>
                            </div>
                            <div>
                                <p class="font-medium text-navy">Pedro Garcia</p>
                                <div class="flex items-center space-x-2">
                                    <div class="flex space-x-1">
                                        <i class="fas fa-star text-yellow-400 text-xs"></i>
                                        <i class="fas fa-star text-yellow-400 text-xs"></i>
                                        <i class="fas fa-star text-yellow-400 text-xs"></i>
                                        <i class="fas fa-star text-yellow-400 text-xs"></i>
                                        <i class="fas fa-star text-gray-300 text-xs"></i>
                                    </div>
                                    <span class="text-sm text-gray-600">4.7 avg</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="font-bold text-navy">12 jobs</span>
                            <p class="text-sm text-gray-600">completed</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Options -->
        <div class="bg-white rounded-xl shadow-lg p-6 mt-8">
            <h2 class="text-xl font-bold font-display text-navy mb-4">Export Reports</h2>
            <div class="flex flex-wrap gap-4">
                <button class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors">
                    <i class="fas fa-file-excel mr-2"></i>Export to Excel
                </button>
                <button class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors">
                    <i class="fas fa-file-pdf mr-2"></i>Export to PDF
                </button>
                <button class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-envelope mr-2"></i>Email Report
                </button>
                <button class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors">
                    <i class="fas fa-print mr-2"></i>Print Report
                </button>
            </div>
        </div>
    </main>

    <!-- Scripts -->
    <script type="module" src="../../public/scripts/firebase.js"></script>
    <script type="module" src="../../public/scripts/admin.js"></script>
    <script type="module">
        import { onAdminAuthChange, getDashboardStats, getRecentBookings } from '../../public/scripts/admin.js';

        document.addEventListener('DOMContentLoaded', function () {
            initializeReportsPage();
        });

        function initializeReportsPage() {
            onAdminAuthChange(async (user, isAdmin) => {
                if (isAdmin) {
                    await loadReportsData();
                } else {
                    window.location.href = '../customer-home.html';
                }
            });

            // Event listeners
            document.getElementById('time-period').addEventListener('change', handleTimePeriodChange);
            document.getElementById('generate-report').addEventListener('click', generateReport);
            // Logout button
            document.getElementById('logout-btn').addEventListener('click', () => {
                window.location.href = '../login.html';
            });
        }

        function handleTimePeriodChange() {
            const timePeriod = document.getElementById('time-period').value;
            const customRange = document.getElementById('custom-range');

            if (timePeriod === 'custom') {
                customRange.classList.remove('hidden');
            } else {
                customRange.classList.add('hidden');
            }
        }

        async function loadReportsData() {
            try {
                // Load basic stats for this month
                const stats = await getDashboardStats();
                const bookings = await getRecentBookings(100);

                // Calculate metrics
                const totalRevenue = bookings.reduce((sum, booking) => {
                    return sum + (booking.payment?.amount || 0);
                }, 0);

                const completedBookings = bookings.filter(b => b.status === 'Completed');
                const avgOrderValue = completedBookings.length > 0 ? totalRevenue / completedBookings.length : 0;

                // Calculate average rating
                const ratingsBookings = bookings.filter(b => b.rating);
                const avgRating = ratingsBookings.length > 0 ?
                    ratingsBookings.reduce((sum, b) => sum + b.rating, 0) / ratingsBookings.length : 0;

                // Update UI
                document.getElementById('total-revenue').textContent = `₱${totalRevenue.toLocaleString()}`;
                document.getElementById('total-bookings').textContent = bookings.length;
                document.getElementById('avg-order-value').textContent = `₱${Math.round(avgOrderValue)}`;
                document.getElementById('avg-rating').textContent = avgRating.toFixed(1);

                // Mock percentage changes (would be calculated from previous period data)
                updateChangeIndicators();

            } catch (error) {
                console.error('Error loading reports data:', error);
            }
        }

        function updateChangeIndicators() {
            // Mock data for demonstration
            const changes = [
                { id: 'revenue-change', value: 12.5, isPositive: true },
                { id: 'bookings-change', value: 8.3, isPositive: true },
                { id: 'aov-change', value: -2.1, isPositive: false },
                { id: 'rating-change', value: 0.3, isPositive: true }
            ];

            changes.forEach(change => {
                const element = document.getElementById(change.id);
                const icon = change.isPositive ? 'fa-arrow-up' : 'fa-arrow-down';
                const color = change.isPositive ? 'text-green-600' : 'text-red-600';
                const sign = change.isPositive ? '+' : '';

                element.className = `text-sm ${color}`;
                element.innerHTML = `<i class="fas ${icon}"></i> ${sign}${Math.abs(change.value)}%`;
            });
        }

        function generateReport() {
            const timePeriod = document.getElementById('time-period').value;
            let dateRange = '';

            if (timePeriod === 'custom') {
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;

                if (!startDate || !endDate) {
                    alert('Please select both start and end dates for custom range');
                    return;
                }

                dateRange = `${startDate} to ${endDate}`;
            } else {
                dateRange = timePeriod;
            }

            alert(`Generating report for: ${dateRange}\n\nReport generation functionality will be implemented with proper data aggregation and chart libraries.`);
        }
    </script>
</body>

</html>