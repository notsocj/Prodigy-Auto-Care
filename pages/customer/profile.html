<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Prodigy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'cream': '#EFE4D2',
                        'blue-dark': '#254D70',
                        'navy': '#131D4F',
                        'brown': '#954C2E'
                    },
                    fontFamily: {
                        'sans': ['Inter', 'system-ui', '-apple-system', 'sans-serif'],
                        'display': ['Poppins', 'system-ui', '-apple-system', 'sans-serif']
                    }
                }
            }
        }
    </script>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="../../public/assets/styles/global.css" rel="stylesheet">
    <style>
        /* Page Transition Animation */
        body {
            animation: fadeIn 0.5s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>

<body class="bg-cream min-h-screen font-sans">
    <!-- Navigation -->
    <nav class="bg-gradient-to-r from-navy via-blue-dark to-navy shadow-2xl border-b border-blue-dark/20">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center py-4 sm:py-5">
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <div class="relative">
                        <i class="fas fa-car text-cream text-2xl sm:text-3xl"
                            style="text-shadow: 0 0 10px rgba(239, 228, 210, 0.5);"></i>
                        <div
                            class="absolute -top-1 -right-1 w-2 h-2 sm:w-3 sm:h-3 bg-brown rounded-full opacity-75 animate-pulse">
                        </div>
                    </div>
                    <div>
                        <h1 class="text-cream text-xl sm:text-3xl font-bold font-display tracking-wide"
                            style="text-shadow: 0 0 10px rgba(239, 228, 210, 0.5);">Prodigy</h1>
                        <p class="text-cream/70 text-xs font-medium tracking-widest uppercase">Auto Care</p>
                    </div>
                </div>
                <!-- Desktop Navigation -->
                <div class="hidden lg:flex items-center space-x-8">
                    <a href="home.html"
                        class="text-cream hover:text-cream/80 transition-all duration-300 font-medium">Book Service</a>
                    <a href="bookings.html"
                        class="text-cream hover:text-cream/80 transition-all duration-300 font-medium">My
                        Bookings</a>
                    <a href="vehicles.html"
                        class="text-cream hover:text-cream/80 transition-all duration-300 font-medium">My
                        Vehicles</a>
                    <a href="profile.html" class="text-cream font-semibold border-b-2 border-cream pb-1">Profile</a>
                </div>

                <!-- Mobile/Desktop Actions -->
                <div class="flex items-center space-x-2 sm:space-x-4">
                    <button id="logout-btn"
                        class="bg-gradient-to-r from-brown to-brown/80 text-white px-3 py-2 sm:px-6 sm:py-3 rounded-lg sm:rounded-xl hover:shadow-lg transition-all duration-300 font-medium">
                        <i class="fas fa-sign-out-alt mr-1 sm:mr-2"></i>
                        <span class="text-sm sm:text-base">Sign Out</span>
                    </button>

                    <!-- Mobile Menu Button -->
                    <button id="mobile-menu-button" class="lg:hidden text-white p-2">
                        <i class="fas fa-bars text-lg sm:text-xl"></i>
                    </button>
                </div>
            </div>
            <div id="mobile-menu" class="lg:hidden hidden py-4 border-t border-white/20">
                <div class="flex flex-col space-y-4">
                    <a href="home.html"
                        class="text-cream hover:text-cream/90 transition-all duration-300 font-medium">Home</a>
                    <a href="bookings.html"
                        class="text-cream hover:text-cream/90 transition-all duration-300 font-medium">My Bookings</a>
                    <a href="vehicles.html"
                        class="text-cream hover:text-cream/90 transition-all duration-300 font-medium">My Vehicles</a>
                    <a href="#" class="text-cream font-semibold">Profile</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 py-6 sm:py-8">
        <!-- Profile Header -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mb-6 sm:mb-8">
            <div class="flex flex-col sm:flex-row items-center sm:items-start space-y-4 sm:space-y-0 sm:space-x-6">
                <div
                    class="w-16 h-16 sm:w-24 sm:h-24 bg-blue-dark text-white rounded-full flex items-center justify-center text-2xl sm:text-3xl font-bold">
                    <span id="profile-initials">CJ</span>
                </div>
                <div class="flex-1 text-center sm:text-left">
                    <h1 id="profile-name" class="text-xl sm:text-2xl font-bold font-display text-navy">Cj Sacdalan</h1>
                    <p id="profile-email" class="text-gray-600 text-sm sm:text-base">cj@email.com</p>
                    <div
                        class="flex flex-col sm:flex-row items-center sm:items-start space-y-2 sm:space-y-0 sm:space-x-4 mt-2">
                        <span class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full">Customer</span>
                        <span class="text-sm text-gray-500">
                            <i class="fas fa-star text-yellow-400 mr-1"></i>
                            <span id="loyalty-points">120</span> Loyalty Points
                        </span>
                    </div>
                </div>
                <button id="edit-profile-btn"
                    class="w-full sm:w-auto bg-blue-dark text-white px-4 py-2 rounded-lg hover:bg-navy transition-colors">
                    <i class="fas fa-edit mr-2"></i>Edit Profile
                </button>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 text-center">
                <div
                    class="w-10 h-10 sm:w-12 sm:h-12 bg-green-100 rounded-lg mx-auto mb-3 sm:mb-4 flex items-center justify-center">
                    <i class="fas fa-check-circle text-green-600 text-lg sm:text-xl"></i>
                </div>
                <h3 class="text-xl sm:text-2xl font-bold text-navy" id="completed-bookings">15</h3>
                <p class="text-xs sm:text-sm text-gray-600">Completed Bookings</p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 text-center">
                <div
                    class="w-10 h-10 sm:w-12 sm:h-12 bg-blue-100 rounded-lg mx-auto mb-3 sm:mb-4 flex items-center justify-center">
                    <i class="fas fa-car text-blue-600 text-lg sm:text-xl"></i>
                </div>
                <h3 class="text-xl sm:text-2xl font-bold text-navy" id="total-vehicles">2</h3>
                <p class="text-xs sm:text-sm text-gray-600">Registered Vehicles</p>
            </div>

            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 text-center">
                <div
                    class="w-10 h-10 sm:w-12 sm:h-12 bg-brown-100 rounded-lg mx-auto mb-3 sm:mb-4 flex items-center justify-center">
                    <i class="fas fa-peso-sign text-brown text-lg sm:text-xl"></i>
                </div>
                <h3 class="text-xl sm:text-2xl font-bold text-navy" id="total-spent">â‚±5,250</h3>
                <p class="text-xs sm:text-sm text-gray-600">Total Spent</p>
            </div>
        </div>

        <!-- Profile Sections -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Personal Information -->
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                <h2 class="text-lg sm:text-xl font-bold font-display text-navy mb-4 sm:mb-6">Personal Information</h2>
                <div class="space-y-3 sm:space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                        <p id="info-name" class="text-gray-900 text-sm sm:text-base">Cj Sacdalan</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <p id="info-email" class="text-gray-900 text-sm sm:text-base break-all">cj@email.com</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                        <p id="info-phone" class="text-gray-900 text-sm sm:text-base">+63 XXX XXX XXXX</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Member Since</label>
                        <p id="info-member-since" class="text-gray-900 text-sm sm:text-base">June 2025</p>
                    </div>
                </div>
            </div>

            <!-- Subscription Status -->
            <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6">
                <h2 class="text-lg sm:text-xl font-bold font-display text-navy mb-4 sm:mb-6">Subscription Status</h2>
                <div id="subscription-info">
                    <div class="text-center p-4 sm:p-6 border-2 border-dashed border-gray-300 rounded-lg">
                        <i class="fas fa-star text-3xl sm:text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-base sm:text-lg font-semibold text-gray-700 mb-2">No Active Subscription</h3>
                        <p class="text-xs sm:text-sm text-gray-500 mb-4">Subscribe to get exclusive benefits and
                            discounts</p>
                        <button
                            class="bg-blue-dark text-white px-4 py-2 rounded-lg hover:bg-navy transition-colors text-sm sm:text-base">
                            View Plans
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="bg-white rounded-xl shadow-lg p-4 sm:p-6 mt-6">
            <h2 class="text-lg sm:text-xl font-bold font-display text-navy mb-4 sm:mb-6">Recent Activity</h2>
            <div id="recent-activity" class="space-y-4">
                <p class="text-gray-500 text-center py-4">No recent activity</p>
            </div>
        </div>
    </main>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal"
        class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md">
            <div class="flex justify-between items-center p-4 sm:p-6 border-b">
                <h3 class="text-lg sm:text-xl font-bold text-navy">Edit Profile</h3>
                <button id="close-edit-modal" class="text-gray-500 hover:text-gray-700 p-1">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>

            <form id="edit-profile-form" class="p-4 sm:p-6 space-y-4">
                <div>
                    <label for="edit-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="edit-name" class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg"
                        required>
                </div>
                <div>
                    <label for="edit-phone" class="block text-sm font-medium text-gray-700 mb-1">Phone Number</label>
                    <input type="tel" id="edit-phone" class="w-full px-3 sm:px-4 py-2 border border-gray-300 rounded-lg"
                        required>
                </div>
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 pt-4">
                    <button type="button" id="cancel-edit"
                        class="w-full bg-gray-300 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-400 transition-colors">
                        Cancel
                    </button>
                    <button type="submit"
                        class="w-full bg-blue-dark text-white py-2 rounded-lg font-semibold hover:bg-navy transition-colors">
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="../../public/scripts/firebase.js"></script>
    <script type="module">
        import {
            auth,
            onAuthChange,
            getCurrentUser,
            logoutUser,
            getUserBookings,
            getUserVehicles
        } from '../../public/scripts/firebase.js';

        let currentUser = null;

        document.addEventListener('DOMContentLoaded', function () {
            initializeProfile();
            initializeModals();
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            window.location.href = '../landing.html';
        });
        function initializeProfile() {
            onAuthChange(async (user) => {
                if (user) {
                    currentUser = await getCurrentUser();
                    if (currentUser) {
                        updateProfileUI();
                        await loadProfileData();
                    }
                } else {
                    // Redirect to login if not authenticated
                    window.location.href = 'login.html';
                }
            });

            // Logout button
            document.getElementById('logout-btn').addEventListener('click', () => {
                window.location.href = '../landing.html';
            });
        }

        function updateProfileUI() {
            if (!currentUser) return;

            // Update profile header
            const initials = currentUser.fullName.split(' ').map(n => n[0]).join('').toUpperCase();
            document.getElementById('profile-initials').textContent = initials;
            document.getElementById('profile-name').textContent = currentUser.fullName;
            document.getElementById('profile-email').textContent = currentUser.email;
            document.getElementById('loyalty-points').textContent = currentUser.loyaltyPoints;

            // Update personal information
            document.getElementById('info-name').textContent = currentUser.fullName;
            document.getElementById('info-email').textContent = currentUser.email;
            document.getElementById('info-phone').textContent = currentUser.phoneNumber || 'Not provided';

            if (currentUser.createdAt) {
                const date = new Date(currentUser.createdAt.seconds * 1000);
                document.getElementById('info-member-since').textContent = date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long'
                });
            }

            // Update subscription info
            updateSubscriptionInfo();
        }

        function updateSubscriptionInfo() {
            const subscriptionDiv = document.getElementById('subscription-info');

            if (currentUser.subscription && currentUser.subscription.active) {
                subscriptionDiv.innerHTML = `
                    <div class="flex items-center justify-between p-4 bg-green-50 border border-green-200 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 bg-green-500 text-white rounded-full flex items-center justify-center">
                                <i class="fas fa-check"></i>
                            </div>
                            <div>
                                <p class="font-semibold text-green-800">Active Subscription</p>
                                <p class="text-sm text-green-600">${currentUser.subscription.type} Plan</p>
                            </div>
                        </div>
                        <span class="px-3 py-1 bg-green-100 text-green-800 text-sm rounded-full">Active</span>
                    </div>
                `;
            } else {
                subscriptionDiv.innerHTML = `
                    <div class="text-center p-6 border-2 border-dashed border-gray-300 rounded-lg">
                        <i class="fas fa-star text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-700 mb-2">No Active Subscription</h3>
                        <p class="text-sm text-gray-500 mb-4">Subscribe to get exclusive benefits and discounts</p>
                        <button class="bg-blue-dark text-white px-4 py-2 rounded-lg hover:bg-navy transition-colors">
                            View Plans
                        </button>
                    </div>
                `;
            }
        }

        async function loadProfileData() {
            try {
                // Load user bookings and vehicles for stats
                const [bookings, vehicles] = await Promise.all([
                    getUserBookings(),
                    getUserVehicles()
                ]);

                // Update stats
                const completedBookings = bookings.filter(b => b.status === 'Completed').length;
                document.getElementById('completed-bookings').textContent = completedBookings;
                document.getElementById('total-vehicles').textContent = vehicles.length;

                // Calculate total spent
                let totalSpent = 0;
                bookings.forEach(booking => {
                    if (booking.payment && booking.payment.amount && booking.status === 'Completed') {
                        totalSpent += booking.payment.amount;
                    }
                });
                document.getElementById('total-spent').textContent = `â‚±${totalSpent.toLocaleString()}`;

                // Update recent activity
                updateRecentActivity(bookings);

            } catch (error) {
                console.error('Error loading profile data:', error);
            }
        }

        function updateRecentActivity(bookings) {
            const activityDiv = document.getElementById('recent-activity');

            if (bookings.length === 0) {
                activityDiv.innerHTML = '<p class="text-gray-500 text-center py-4">No recent activity</p>';
                return;
            }

            // Show last 5 bookings
            const recentBookings = bookings.slice(0, 5);

            activityDiv.innerHTML = recentBookings.map(booking => {
                let statusColor = 'gray';
                if (booking.status === 'Completed') statusColor = 'green';
                if (booking.status === 'Pending') statusColor = 'yellow';
                if (booking.status === 'Ongoing') statusColor = 'blue';
                if (booking.status === 'Cancelled') statusColor = 'red';

                return `
                    <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                        <div class="flex items-center space-x-3">
                            <div class="w-3 h-3 bg-${statusColor}-500 rounded-full"></div>
                            <div>
                                <p class="font-medium text-navy">${booking.service}</p>
                                <p class="text-sm text-gray-600">${booking.date} at ${booking.time}</p>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="px-3 py-1 bg-${statusColor}-100 text-${statusColor}-800 text-sm rounded-full">${booking.status}</span>
                            <p class="text-sm font-medium text-brown mt-1">â‚±${booking.payment?.amount || 0}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function initializeModals() {
            const editProfileBtn = document.getElementById('edit-profile-btn');
            const editProfileModal = document.getElementById('edit-profile-modal');
            const closeEditModal = document.getElementById('close-edit-modal');
            const cancelEdit = document.getElementById('cancel-edit');
            const editProfileForm = document.getElementById('edit-profile-form');

            editProfileBtn.addEventListener('click', () => {
                // Populate form with current values
                document.getElementById('edit-name').value = currentUser.fullName;
                document.getElementById('edit-phone').value = currentUser.phoneNumber || '';
                editProfileModal.classList.remove('hidden');
            });

            closeEditModal.addEventListener('click', () => {
                editProfileModal.classList.add('hidden');
            });

            cancelEdit.addEventListener('click', () => {
                editProfileModal.classList.add('hidden');
            });

            editProfileForm.addEventListener('submit', async (e) => {
                e.preventDefault();

                const newName = document.getElementById('edit-name').value.trim();
                const newPhone = document.getElementById('edit-phone').value.trim();

                try {
                    // Update user profile in Firebase
                    // This would require implementing an updateUser function in firebase.js
                    alert('Profile update functionality will be implemented');
                    editProfileModal.classList.add('hidden');
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert('Error updating profile: ' + error.message);
                }
            });
        }

        // Add mobile menu toggle
        document.getElementById('mobile-menu-button').addEventListener('click', () => {
            const mobileMenu = document.getElementById('mobile-menu');
            mobileMenu.classList.toggle('hidden');
        });
    </script>
</body>

</html>